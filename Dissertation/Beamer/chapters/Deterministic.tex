% !TeX root = ../main.tex

\section{Seat Planning with Deterministic Demand}
    \frame{\sectionpage}

  \begin{frame}{Deterministic Formulation}  %开始一张幻灯片
    Seat planning problem with given demand $\bm{d}$:

    \begin{equation}\label{deter_upper}
      \begin{aligned}
      \max \quad & \sum_{i=1}^{M}  \sum_{j= 1}^{N} (n_i- \delta) x_{ij} \\
      \text {s.t.} \quad & \sum_{j= 1}^{N} x_{ij} \leq d_{i}, \quad i \in \mathcal{M}, \\
      & \sum_{i=1}^{M} n_{i} x_{ij} \leq L_j, j \in \mathcal{N}, \\
      & x_{ij} \in \mathbb{Z}^{+}_{0}, \quad i \in \mathcal{M}, j \in \mathcal{N}.
      \end{aligned}
    \end{equation}
    Objective: maximize the number of people accommodated.

    $x_{ij}$: the number of group type $i$ in row $j$.
  \end{frame}

  \begin{frame}{Property}
    In the LP relaxation of problem \eqref{deter_upper}, there is a threshold $\tilde{i} \in\{0,1,\ldots, M\}$ such that the optimal solutions satisfy the following conditions:

    \begin{itemize}
      \item For $i = 1,\ldots, \tilde{i} -1$ and all $j$, $x_{ij}^{*} = 0$. 
      % indicating that no group type $i$ are assigned to any rows before index $v$.
      \item For $i = \tilde{i} +1,\ldots, M$, $\sum_{j} x_{ij}^{*} = d_{i}$. 

      \item For $i = \tilde{i}$, $\sum_{j} x_{ij}^{*} = \frac{L - \sum_{i = \tilde{i}+1}^{M} {d_i n_i}}{n_{\tilde{i}}}$ 
      % This quantity is determined by the available supply, which is calculated as the remaining seats after accommodating the demands for group types $v+1$ to $M$, divided by the size of group type $v$, denoted as $n_v$.
    \end{itemize}

    \vspace{0.5cm}
    The seat planning obtained from problem \eqref{deter_upper} may not utilize all seats.

    \vspace{0.5cm}
    
    We aim to improve the seat planning utilizing all seats.

    % We aim to generate a seat planning utilizing all seats while ensuring that the demand requirements are met.
  \end{frame}

  \begin{frame}{Generate the Full or Largest Pattern}
    Specifically, we can convert a given specific pattern into a largest or full pattern while ensuring that the original group type requirements are met. Our objective is to generate the pattern with maximal people.

    Mathematically, for any pattern $\bm{h} = (h_1, \ldots, h_M)$, we seek to find a feasible pattern $\bm{h}^{'} = (h_1^{'}, \ldots, h_M^{'})$ that satisfies the following programming.

    \begin{equation*}\label{full_largest}
      \begin{aligned}
      \max \quad & |\bm{h}^{'}| \\
      \text {s.t.} \quad & h_M^{'} \geq h_M \\
      &  h_{M-1}^{'} + h_M^{'} \geq h_{M-1} + h_M \\
      & \cdots \\
      & h_1^{'} + \ldots + h_M^{'} \geq h_1 + \ldots + h_M.
      \end{aligned}
    \end{equation*}

    Constraints: a group can take the seats planned for the larger group.
  \end{frame}

  \begin{frame}{Algorithm to Generate the Full or Largest Pattern}
    For each row $j$, let $\beta_{j} = L_{j} - \sum_{i} n_{i} x_{ij}$. We aim to allocate the remaining unoccupied seats ($\beta_{j}$) in row $j$ to maximize the number of people while satisfying the original group type requirements.
    \vspace{0.5cm}
    
    Allocation scheme of $\beta_{j}$:
    \vspace{0.5cm}

    \begin{scriptsize}
      Let $k = \min\{i | h_i > 0\}$ for a pattern $\bm{h}$.

      \begin{itemize}
        \item If $k \neq M$, $h_{k} \gets h_{k} -1$, $h_{\min_{\{(k+\beta_{j}), M\}}} \gets h_{\min_{\{(k+\beta_{j}), M\}}} +1$, $\beta_{j} \gets \beta_{j} - \max\{1, M - k\}$. Continue this procedure until all groups are largest or $\beta_{j} =0$. 
        \item If $k = M$ and $\beta_{j} > 0$, continue the following procedure until $\beta_{j} < n_{1}$.
        \item[-] When $\beta_{j} \geq n_{M}$, $q \gets \lfloor\frac{\beta}{n_M}\rfloor$, $\beta_{j} \gets \beta_{j} - q n_M$, $h_{M} \gets h_{M} + q$.
        \item[-] When $n_{1} \leq \beta_{j} < n_{M}$, $h_{\beta_{j}-n_1+1} \gets h_{\beta_{j}-n_1+1} + 1$, $\beta_{j} \gets 0$.
        % \item[] assign $\beta$ in a greedy way.
      \end{itemize}  
    \end{scriptsize}
    
  \end{frame}